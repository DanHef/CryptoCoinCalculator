"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var core_1 = require("@angular/core");
var calculation_service_1 = require("../services/calculation.service");
var router_1 = require("@angular/router");
var router_2 = require("nativescript-angular/router");
var nativescript_drop_down_1 = require("nativescript-drop-down");
var portfolio_item_service_1 = require("../services/portfolio-item.service");
var currency_price_service_1 = require("../services/currency-price.service");
var core_2 = require("@ngx-translate/core");
var CreateCalculationComponent = /** @class */ (function () {
    function CreateCalculationComponent(calculationService, router, routerExtension, portfolioItemService, currencyPriceService, translateService) {
        this.calculationService = calculationService;
        this.router = router;
        this.routerExtension = routerExtension;
        this.portfolioItemService = portfolioItemService;
        this.currencyPriceService = currencyPriceService;
        this.translateService = translateService;
        this.platformList = new nativescript_drop_down_1.ValueList([
            { value: "bitstamp", display: "Bitstamp" },
            { value: "bitfinex", display: "Bitfinex" }
        ]);
        this.hint = null;
        this.selectedIndexPlatformList = this.platformList.getIndex("bitstamp");
        this.platform = this.platformList.getValue(this.selectedIndexPlatformList);
    }
    CreateCalculationComponent.prototype.ngOnInit = function () {
        //initialize source portfolio names with default platform "bitstamp"
        this.fillPortfolioItemsList("bitstamp");
        this.fillSymbolsList("bitstamp");
    };
    CreateCalculationComponent.prototype.createCalculationResult = function () {
        if (!this.platform ||
            !this.description ||
            !this.targetCurrencySymbol ||
            !this.sourcePortfolioItemName) {
            this.translateService.get("errorFillInAllFields").subscribe(function (translatedText) {
                alert(translatedText);
            });
        }
        else {
            this.calculationService.createCalculationResult(this.sourcePortfolioItemName.toLowerCase(), this.targetCurrencySymbol.toLowerCase(), this.description, this.platform.toLowerCase());
            this.calculationService.saveCalculationResults();
            this.routerExtension.back();
        }
    };
    CreateCalculationComponent.prototype.onPlatformChange = function (event) {
        this.platform = this.platformList.getValue(event.newIndex);
        this.fillPortfolioItemsList(this.platform);
        this.fillSymbolsList(this.platform);
    };
    CreateCalculationComponent.prototype.fillPortfolioItemsList = function (platform) {
        var portfolioItems = this.portfolioItemService.getAllPortfolioItems();
        var valueList = new nativescript_drop_down_1.ValueList();
        for (var i = 0; i < portfolioItems.length; i++) {
            if (portfolioItems[i].getPortfolioName() === platform) {
                var newValueItem = { value: portfolioItems[i].getPortfolioItemName(), display: portfolioItems[i].getPortfolioItemDescription() };
                valueList.push(newValueItem);
            }
        }
        this.sourcePortfolioNames = valueList;
    };
    CreateCalculationComponent.prototype.fillSymbolsList = function (platform) {
        var distinctSymbols = this.currencyPriceService.getDistinctCurrencySymbols(platform);
        var newValueList = new nativescript_drop_down_1.ValueList();
        for (var i = 0; i < distinctSymbols.length; i++) {
            var newValueItem = { value: distinctSymbols[i], display: distinctSymbols[i] };
            newValueList.push(newValueItem);
        }
        this.targetCurrencySymbolList = newValueList;
    };
    CreateCalculationComponent.prototype.onSourcePortfolioChange = function (event) {
        this.sourcePortfolioItemName = this.sourcePortfolioNames.getValue(event.newIndex);
    };
    CreateCalculationComponent.prototype.onTargetCurrencyChange = function (event) {
        this.targetCurrencySymbol = this.targetCurrencySymbolList.getValue(event.newIndex);
    };
    CreateCalculationComponent = __decorate([
        core_1.Component({
            selector: "create-calculation",
            moduleId: module.id,
            templateUrl: "./create-calculation.component.html",
        }),
        __metadata("design:paramtypes", [calculation_service_1.CalculationService,
            router_1.Router,
            router_2.RouterExtensions,
            portfolio_item_service_1.PortfolioItemService,
            currency_price_service_1.CurrencyPriceService,
            core_2.TranslateService])
    ], CreateCalculationComponent);
    return CreateCalculationComponent;
}());
exports.CreateCalculationComponent = CreateCalculationComponent;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY3JlYXRlLWNhbGN1bGF0aW9uLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImNyZWF0ZS1jYWxjdWxhdGlvbi5jb21wb25lbnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxzQ0FBa0Q7QUFFbEQsdUVBQXFFO0FBRXJFLDBDQUF5QztBQUN6QyxzREFBK0Q7QUFFL0QsaUVBQW1EO0FBRW5ELDZFQUEwRTtBQUMxRSw2RUFBMEU7QUFFMUUsNENBQXVEO0FBT3ZEO0lBb0JJLG9DQUE2QixrQkFBc0MsRUFDdEMsTUFBYyxFQUNkLGVBQWlDLEVBQ2pDLG9CQUEwQyxFQUMxQyxvQkFBMEMsRUFDMUMsZ0JBQWtDO1FBTGxDLHVCQUFrQixHQUFsQixrQkFBa0IsQ0FBb0I7UUFDdEMsV0FBTSxHQUFOLE1BQU0sQ0FBUTtRQUNkLG9CQUFlLEdBQWYsZUFBZSxDQUFrQjtRQUNqQyx5QkFBb0IsR0FBcEIsb0JBQW9CLENBQXNCO1FBQzFDLHlCQUFvQixHQUFwQixvQkFBb0IsQ0FBc0I7UUFDMUMscUJBQWdCLEdBQWhCLGdCQUFnQixDQUFrQjtRQXBCL0QsaUJBQVksR0FBcUIsSUFBSSxrQ0FBUyxDQUFTO1lBQ25ELEVBQUUsS0FBSyxFQUFFLFVBQVUsRUFBRSxPQUFPLEVBQUUsVUFBVSxFQUFFO1lBQzFDLEVBQUUsS0FBSyxFQUFFLFVBQVUsRUFBRSxPQUFPLEVBQUUsVUFBVSxFQUFFO1NBQzdDLENBQUMsQ0FBQztRQUNILFNBQUksR0FBRyxJQUFJLENBQUM7UUFHWiw4QkFBeUIsR0FBVSxJQUFJLENBQUMsWUFBWSxDQUFDLFFBQVEsQ0FBQyxVQUFVLENBQUMsQ0FBQztRQUcxRSxhQUFRLEdBQVcsSUFBSSxDQUFDLFlBQVksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLHlCQUF5QixDQUFDLENBQUM7SUFZOUUsQ0FBQztJQUVELDZDQUFRLEdBQVI7UUFDSSxvRUFBb0U7UUFDcEUsSUFBSSxDQUFDLHNCQUFzQixDQUFDLFVBQVUsQ0FB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LENBQUMsdUJBQXVCLEdBQUcsSUFBSSxDQUFDLG9CQUFvQixDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsUUFBUSxDQUFDLENBQUM7SUFDdEYsQ0FBQztJQUVELDJEQUFzQixHQUF0QixVQUF1QixLQUFLO1FBQ3hCLElBQUksQ0FBQyxvQkFBb0IsR0FBRyxJQUFJLENBQUMsd0JBQXdCLENBQUMsUUFBUSxDQUFDLEtBQUssQ0FBQyxRQUFRLENBQUMsQ0FBQztJQUN2RixDQUFDO0lBNUZRLDBCQUEwQjtRQUx0QyxnQkFBUyxDQUFDO1lBQ1AsUUFBUSxFQUFFLG9CQUFvQjtZQUM5QixRQUFRLEVBQUUsTUFBTSxDQUFDLEVBQUU7WUFDbkIsV0FBVyxFQUFFLHFDQUFxQztTQUNyRCxDQUFDO3lDQXFCbUQsd0NBQWtCO1lBQzlCLGVBQU07WUFDRyx5QkFBZ0I7WUFDWCw2Q0FBb0I7WUFDcEIsNkNBQW9CO1lBQ3hCLHVCQUFnQjtPQXpCdEQsMEJBQTBCLENBNkZ0QztJQUFELGlDQUFDO0NBQUEsQUE3RkQsSUE2RkM7QUE3RlksZ0VBQTBCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQ29tcG9uZW50LCBPbkluaXQgfSBmcm9tIFwiQGFuZ3VsYXIvY29yZVwiO1xuXG5pbXBvcnQgeyBDYWxjdWxhdGlvblNlcnZpY2UgfSBmcm9tIFwiLi4vc2VydmljZXMvY2FsY3VsYXRpb24uc2VydmljZVwiO1xuXG5pbXBvcnQgeyBSb3V0ZXIgfSBmcm9tIFwiQGFuZ3VsYXIvcm91dGVyXCI7XG5pbXBvcnQgeyBSb3V0ZXJFeHRlbnNpb25zIH0gZnJvbSBcIm5hdGl2ZXNjcmlwdC1hbmd1bGFyL3JvdXRlclwiO1xuXG5pbXBvcnQgeyBWYWx1ZUxpc3QgfSBmcm9tIFwibmF0aXZlc2NyaXB0LWRyb3AtZG93blwiO1xuXG5pbXBvcnQgeyBQb3J0Zm9saW9JdGVtU2VydmljZSB9IGZyb20gXCIuLi9zZXJ2aWNlcy9wb3J0Zm9saW8taXRlbS5zZXJ2aWNlXCI7XG5pbXBvcnQgeyBDdXJyZW5jeVByaWNlU2VydmljZSB9IGZyb20gXCIuLi9zZXJ2aWNlcy9jdXJyZW5jeS1wcmljZS5zZXJ2aWNlXCI7XG5cbmltcG9ydCB7IFRyYW5zbGF0ZVNlcnZpY2UgfSBmcm9tIFwiQG5neC10cmFuc2xhdGUvY29yZVwiO1xuXG5AQ29tcG9uZW50KHtcbiAgICBzZWxlY3RvcjogXCJjcmVhdGUtY2FsY3VsYXRpb25cIixcbiAgICBtb2R1bGVJZDogbW9kdWxlLmlkLFxuICAgIHRlbXBsYXRlVXJsOiBcIi4vY3JlYXRlLWNhbGN1bGF0aW9uLmNvbXBvbmVudC5odG1sXCIsXG59KVxuZXhwb3J0IGNsYXNzIENyZWF0ZUNhbGN1bGF0aW9uQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0IHtcbiAgICBzb3VyY2VQb3J0Zm9saW9JdGVtTmFtZTogc3RyaW5nO1xuICAgIHRhcmdldEN1cnJlbmN5U3ltYm9sOnN0cmluZztcbiAgICBkZXNjcmlwdGlvbjogc3RyaW5nO1xuXG4gICAgcGxhdGZvcm1MaXN0OlZhbHVlTGlzdDxzdHJpbmc+ID0gbmV3IFZhbHVlTGlzdDxzdHJpbmc+KFtcbiAgICAgICAgeyB2YWx1ZTogXCJiaXRzdGFtcFwiLCBkaXNwbGF5OiBcIkJpdHN0YW1wXCIgfSwgXG4gICAgICAgIHsgdmFsdWU6IFwiYml0ZmluZXhcIiwgZGlzcGxheTogXCJCaXRmaW5leFwiIH1cbiAgICBdKTtcbiAgICBoaW50ID0gbnVsbDtcblxuICAgIHNvdXJjZVBvcnRmb2xpb05hbWVzOiBWYWx1ZUxpc3Q8c3RyaW5nPjtcbiAgICBzZWxlY3RlZEluZGV4UGxhdGZvcm1MaXN0Om51bWJlciA9IHRoaXMucGxhdGZvcm1MaXN0LmdldEluZGV4KFwiYml0c3RhbXBcIik7XG4gICAgc2VsZWN0ZWRJbmRleFNvdXJjZVBvcnRmb2xpbzpudW1iZXI7XG5cbiAgICBwbGF0Zm9ybTogc3RyaW5nID0gdGhpcy5wbGF0Zm9ybUxpc3QuZ2V0VmFsdWUodGhpcy5zZWxlY3RlZEluZGV4UGxhdGZvcm1MaXN0KTtcblxuICAgIHRhcmdldEN1cnJlbmN5U3ltYm9sTGlzdDogVmFsdWVMaXN0PHN0cmluZz47XG4gICAgc2VsZWN0ZWRJbmRleFRhcmdldEN1cnJlbmN5OiBudW1iZXI7XG5cbiAgICBjb25zdHJ1Y3Rvcihwcml2YXRlIHJlYWRvbmx5IGNhbGN1bGF0aW9uU2VydmljZTogQ2FsY3VsYXRpb25TZXJ2aWNlLFxuICAgICAgICAgICAgICAgIHByaXZhdGUgcmVhZG9ubHkgcm91dGVyOiBSb3V0ZXIsXG4gICAgICAgICAgICAgICAgcHJpdmF0ZSByZWFkb25seSByb3V0ZXJFeHRlbnNpb246IFJvdXRlckV4dGVuc2lvbnMsXG4gICAgICAgICAgICAgICAgcHJpdmF0ZSByZWFkb25seSBwb3J0Zm9saW9JdGVtU2VydmljZTogUG9ydGZvbGlvSXRlbVNlcnZpY2UsXG4gICAgICAgICAgICAgICAgcHJpdmF0ZSByZWFkb25seSBjdXJyZW5jeVByaWNlU2VydmljZTogQ3VycmVuY3lQcmljZVNlcnZpY2UsXG4gICAgICAgICAgICAgICAgcHJpdmF0ZSByZWFkb25seSB0cmFuc2xhdGVTZXJ2aWNlOiBUcmFuc2xhdGVTZXJ2aWNlKSB7IFxuICAgICAgICBcbiAgICB9XG5cbiAgICBuZ09uSW5pdCgpIHtcbiAgICAgICAgLy9pbml0aWFsaXplIHNvdXJjZSBwb3J0Zm9saW8gbmFtZXMgd2l0aCBkZWZhdWx0IHBsYXRmb3JtIFwiYml0c3RhbXBcIlxuICAgICAgICB0aGlzLmZpbGxQb3J0Zm9saW9JdGVtc0xpc3QoXCJiaXRzdGFtcFwiKTtcbiAgICAgICAgdGhpcy5maWxsU3ltYm9sc0xpc3QoXCJiaXRzdGFtcFwiKTtcbiAgICB9XG5cblxuICAgIGNyZWF0ZUNhbGN1bGF0aW9uUmVzdWx0KCkge1xuICAgICAgICBpZighdGhpcy5wbGF0Zm9ybSB8fFxuICAgICAgICAgICAgIXRoaXMuZGVzY3JpcHRpb24gfHxcbiAgICAgICAgICAgICF0aGlzLnRhcmdldEN1cnJlbmN5U3ltYm9sIHx8XG4gICAgICAgICAgICAhdGhpcy5zb3VyY2VQb3J0Zm9saW9JdGVtTmFtZSkge1xuICAgICAgICAgICAgICAgIHRoaXMudHJhbnNsYXRlU2VydmljZS5nZXQoXCJlcnJvckZpbGxJbkFsbEZpZWxkc1wiKS5zdWJzY3JpYmUoKHRyYW5zbGF0ZWRUZXh0KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGFsZXJ0KHRyYW5zbGF0ZWRUZXh0KTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuY2FsY3VsYXRpb25TZXJ2aWNlLmNyZWF0ZUNhbGN1bGF0aW9uUmVzdWx0KHRoaXMuc291cmNlUG9ydGZvbGlvSXRlbU5hbWUudG9Mb3dlckNhc2UoKSwgdGhpcy50YXJnZXRDdXJyZW5jeVN5bWJvbC50b0xvd2VyQ2FzZSgpLCB0aGlzLmRlc2NyaXB0aW9uLCB0aGlzLnBsYXRmb3JtLnRvTG93ZXJDYXNlKCkpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICB0aGlzLmNhbGN1bGF0aW9uU2VydmljZS5zYXZlQ2FsY3VsYXRpb25SZXN1bHRzKCk7XG4gICAgICAgICAgICB0aGlzLnJvdXRlckV4dGVuc2lvbi5iYWNrKCk7XG4gICAgICAgIH1cbiAgICB9XG5cblxuICAgIG9uUGxhdGZvcm1DaGFuZ2UoZXZlbnQpIHtcbiAgICAgICAgdGhpcy5wbGF0Zm9ybSA9IHRoaXMucGxhdGZvcm1MaXN0LmdldFZhbHVlKGV2ZW50Lm5ld0luZGV4KTtcblxuICAgICAgICB0aGlzLmZpbGxQb3J0Zm9saW9JdGVtc0xpc3QodGhpcy5wbGF0Zm9ybSk7XG4gICAgICAgIHRoaXMuZmlsbFN5bWJvbHNMaXN0KHRoaXMucGxhdGZvcm0pO1xuICAgIH1cblxuICAgIHByaXZhdGUgZmlsbFBvcnRmb2xpb0l0ZW1zTGlzdChwbGF0Zm9ybTogc3RyaW5nKSB7XG4gICAgICAgIGxldCBwb3J0Zm9saW9JdGVtcyA9IHRoaXMucG9ydGZvbGlvSXRlbVNlcnZpY2UuZ2V0QWxsUG9ydGZvbGlvSXRlbXMoKTtcbiAgICAgICAgbGV0IHZhbHVlTGlzdCA9IG5ldyBWYWx1ZUxpc3Q8c3RyaW5nPigpO1xuXG4gICAgICAgIGZvcih2YXIgaT0wOyBpPHBvcnRmb2xpb0l0ZW1zLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBpZihwb3J0Zm9saW9JdGVtc1tpXS5nZXRQb3J0Zm9saW9OYW1lKCkgPT09IHBsYXRmb3JtKSB7XG4gICAgICAgICAgICAgICAgbGV0IG5ld1ZhbHVlSXRlbSA9IHsgdmFsdWU6IHBvcnRmb2xpb0l0ZW1zW2ldLmdldFBvcnRmb2xpb0l0ZW1OYW1lKCksIGRpc3BsYXk6IHBvcnRmb2xpb0l0ZW1zW2ldLmdldFBvcnRmb2xpb0l0ZW1EZXNjcmlwdGlvbigpIH07XG4gICAgICAgICAgICAgICAgdmFsdWVMaXN0LnB1c2gobmV3VmFsdWVJdGVtKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuc291cmNlUG9ydGZvbGlvTmFtZXMgPSB2YWx1ZUxpc3Q7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBmaWxsU3ltYm9sc0xpc3QocGxhdGZvcm06c3RyaW5nKSB7XG4gICAgICAgIGxldCBkaXN0aW5jdFN5bWJvbHMgPSB0aGlzLmN1cnJlbmN5UHJpY2VTZXJ2aWNlLmdldERpc3RpbmN0Q3VycmVuY3lTeW1ib2xzKHBsYXRmb3JtKTtcbiAgICAgICAgbGV0IG5ld1ZhbHVlTGlzdCA9IG5ldyBWYWx1ZUxpc3Q8c3RyaW5nPigpO1xuXG4gICAgICAgIGZvcih2YXIgaT0wOyBpPGRpc3RpbmN0U3ltYm9scy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgbGV0IG5ld1ZhbHVlSXRlbSA9IHt2YWx1ZTogZGlzdGluY3RTeW1ib2xzW2ldLCBkaXNwbGF5OiBkaXN0aW5jdFN5bWJvbHNbaV19O1xuICAgICAgICAgICAgbmV3VmFsdWVMaXN0LnB1c2gobmV3VmFsdWVJdGVtKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMudGFyZ2V0Q3VycmVuY3lTeW1ib2xMaXN0ID0gbmV3VmFsdWVMaXN0O1xuICAgIH1cblxuICAgIG9uU291cmNlUG9ydGZvbGlvQ2hhbmdlKGV2ZW50KSB7XG4gICAgICAgIHRoaXMuc291cmNlUG9ydGZvbGlvSXRlbU5hbWUgPSB0aGlzLnNvdXJjZVBvcnRmb2xpb05hbWVzLmdldFZhbHVlKGV2ZW50Lm5ld0luZGV4KTtcbiAgICB9XG5cbiAgICBvblRhcmdldEN1cnJlbmN5Q2hhbmdlKGV2ZW50KSB7XG4gICAgICAgIHRoaXMudGFyZ2V0Q3VycmVuY3lTeW1ib2wgPSB0aGlzLnRhcmdldEN1cnJlbmN5U3ltYm9sTGlzdC5nZXRWYWx1ZShldmVudC5uZXdJbmRleCk7XG4gICAgfVxufSJdfQ==