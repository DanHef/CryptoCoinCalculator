"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var core_1 = require("@angular/core");
var CalculationResult_1 = require("../CalculationResult");
var nativescript_secure_storage_1 = require("nativescript-secure-storage");
var portfolio_item_service_1 = require("./portfolio-item.service");
var currency_price_service_1 = require("./currency-price.service");
var CalculationService = (function () {
    function CalculationService(portfolioItemService, currencyPriceService) {
        this.portfolioItemService = portfolioItemService;
        this.currencyPriceService = currencyPriceService;
        this.calculationResults = [];
        this.secureStorage = new nativescript_secure_storage_1.SecureStorage();
    }
    CalculationService.prototype.addCalculationResult = function (calculationResult) {
        this.calculationResults.push(calculationResult);
    };
    CalculationService.prototype.createCalculationResult = function (sourcePortfolioItemName, targetCurrencySymbol, description, platform) {
        var portfolioItem = this.portfolioItemService.getPortfolioItemByTechnicalName(sourcePortfolioItemName, platform);
        var currencyPrice = this.currencyPriceService.getCurrencyPrice(portfolioItem.getSymbol(), targetCurrencySymbol, platform);
        var newCalculationResult = new CalculationResult_1.CalculationResult(description, portfolioItem, currencyPrice, platform);
        this.calculationResults.push(newCalculationResult);
        return newCalculationResult;
    };
    CalculationService.prototype.calculateAllResults = function () {
        for (var i = 0; i < this.calculationResults.length; i++) {
            this.calculateResult(this.calculationResults[i]);
        }
    };
    CalculationService.prototype.calculateResult = function (calculationResult) {
        calculationResult.getResult();
    };
    CalculationService.prototype.getAllCalculationResults = function () {
        return this.calculationResults;
    };
    //TODO: save and load have to be renewed
    CalculationService.prototype.saveCalculationResults = function () {
        this.secureStorage.setSync({
            key: "cryptoCoinCalcCalculationResultData",
            value: JSON.stringify(this.calculationResults)
        });
    };
    CalculationService.prototype.loadCurrencyPrices = function () {
        var storedCalculationResultString = this.secureStorage.getSync({
            key: "cryptoCoinCalcCalculationResultData",
        });
        if (storedCalculationResultString) {
            var storedCalculationResults = JSON.parse(storedCalculationResultString);
            for (var i = 0; i < storedCalculationResults.length; i++) {
                var storedCalculationResult = storedCalculationResults[i];
                this.createCalculationResult(storedCalculationResult.currencyCodeFrom, storedCalculationResult.currencyCodeTo, storedCalculationResult.description, storedCalculationResult.platform);
            }
        }
    };
    CalculationService = __decorate([
        core_1.Injectable(),
        __metadata("design:paramtypes", [portfolio_item_service_1.PortfolioItemService,
            currency_price_service_1.CurrencyPriceService])
    ], CalculationService);
    return CalculationService;
}());
exports.CalculationService = CalculationService;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2FsY3VsYXRpb24uc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImNhbGN1bGF0aW9uLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxzQ0FBMkM7QUFFM0MsMERBQXlEO0FBQ3pELDJFQUE0RDtBQUU1RCxtRUFBZ0U7QUFDaEUsbUVBQWdFO0FBSWhFO0lBSUksNEJBQTZCLG9CQUEwQyxFQUMxQyxvQkFBMEM7UUFEMUMseUJBQW9CLEdBQXBCLG9CQUFvQixDQUFzQjtRQUMxQyx5QkFBb0IsR0FBcEIsb0JBQW9CLENBQXNCO1FBSi9ELHVCQUFrQixHQUE2QixFQUFFLENBQUM7UUFDbEQsa0JBQWEsR0FBa0IsSUFBSSwyQ0FBYSxFQUFFLENBQUM7SUFHZ0IsQ0FBQztJQUU1RSxpREFBb0IsR0FBcEIsVUFBcUIsaUJBQWlCO1FBQ2xDLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxJQUFJLENBQUMsaUJBQWlCLENBQUMsQ0FBQztJQUNwRCxDQUFDO0lBR0Qsb0RBQXVCLEdBQXZCLFVBQXdCLHVCQUErQixFQUFFLG9CQUE0QixFQUM3RCxXQUFtQixFQUFFLFFBQWdCO1FBQ3pELElBQUksYUFBYSxHQUFHLElBQUksQ0FBQyxvQkFBb0IsQ0FBQywrQkFBK0IsQ0FBQyx1QkFBdUIsRUFBRSxRQUFRLENBQUMsQ0FBQztRQUNqSCxJQUFJLGFBQWEsR0FBRyxJQUFJLENBQUMsb0JBQW9CLENBQUMsZ0JBQWdCLENBQUMsYUFBYSxDQUFDLFNBQVMsRUFBRSxFQUFFLG9CQUFvQixFQUFFLFFBQVEsQ0FBQyxDQUFDO1FBRTFILElBQUksb0JBQW9CLEdBQUcsSUFBSSxxQ0FBaUIsQ0FBQyxXQUFXLEVBQUUsYUFBYSxFQUFFLGFBQWEsRUFBRSxRQUFRLENBQUMsQ0FBQztRQUV0RyxJQUFJLENBQUMsa0JBQWtCLENBQUMsSUFBSSxDQUFDLG9CQUFvQixDQUFDLENBQUM7UUFFbkQsTUFBTSxDQUFDLG9CQUFvQixDQUFDO0lBQ2hDLENBQUM7SUFHRCxnREFBbUIsR0FBbkI7UUFDSSxHQUFHLENBQUEsQ0FBQyxJQUFJLENBQUMsR0FBQyxDQUFDLEVBQUUsQ0FBQyxHQUFDLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxFQUFFLEVBQUUsQ0FBQztZQUNqRCxJQUFJLENBQUMsZUFBZSxDQUFDLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ3JELENBQUM7SUFDTCxDQUFDO0lBRUQsNENBQWUsR0FBZixVQUFnQixpQkFBb0M7UUFDaEQsaUJBQWlCLENBQUMsU0FBUyxFQUFFLENBQUM7SUFDbEMsQ0FBQztJQUVELHFEQUF3QixHQUF4QjtRQUNJLE1BQU0sQ0FBQyxJQUFJLENBQUMsa0JBQWtCLENBQUM7SUFDbkMsQ0FBQztJQUVELHdDQUF3QztJQUV4QyxtREFBc0IsR0FBdEI7UUFDSSxJQUFJLENBQUMsYUFBYSxDQUFDLE9BQU8sQ0FBQztZQUN2QixHQUFHLEVBQUUscUNBQXFDO1lBQzFDLEtBQUssRUFBRSxJQUFJLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxrQkFBa0IsQ0FBQztTQUNqRCxDQUFDLENBQUM7SUFDUCxDQUFDO0lBRUQsK0NBQWtCLEdBQWxCO1FBQ0ksSUFBSSw2QkFBNkIsR0FBRyxJQUFJLENBQUMsYUFBYSxDQUFDLE9BQU8sQ0FBQztZQUMzRCxHQUFHLEVBQUUscUNBQXFDO1NBQzdDLENBQUMsQ0FBQztRQUVILEVBQUUsQ0FBQyxDQUFDLDZCQUE2QixDQUFDLENBQUMsQ0FBQztZQUNoQyxJQUFJLHdCQUF3QixHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsNkJBQTZCLENBQUMsQ0FBQztZQUV6RSxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLHdCQUF3QixDQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDO2dCQUN2RCxJQUFJLHVCQUF1QixHQUFHLHdCQUF3QixDQUFDLENBQUMsQ0FBQyxDQUFDO2dCQUUxRCxJQUFJLENBQUMsdUJBQXVCLENBQUMsdUJBQXVCLENBQUMsZ0JBQWdCLEVBQ2pFLHVCQUF1QixDQUFDLGNBQWMsRUFDdEMsdUJBQXVCLENBQUMsV0FBVyxFQUNuQyx1QkFBdUIsQ0FBQyxRQUFRLENBQUMsQ0FBQztZQUUxQyxDQUFDO1FBQ0wsQ0FBQztJQUNMLENBQUM7SUFsRVEsa0JBQWtCO1FBRDlCLGlCQUFVLEVBQUU7eUNBSzBDLDZDQUFvQjtZQUNwQiw2Q0FBb0I7T0FMOUQsa0JBQWtCLENBbUU5QjtJQUFELHlCQUFDO0NBQUEsQUFuRUQsSUFtRUM7QUFuRVksZ0RBQWtCIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0YWJsZSB9IGZyb20gXCJAYW5ndWxhci9jb3JlXCI7XG5cbmltcG9ydCB7IENhbGN1bGF0aW9uUmVzdWx0IH0gZnJvbSBcIi4uL0NhbGN1bGF0aW9uUmVzdWx0XCI7XG5pbXBvcnQgeyBTZWN1cmVTdG9yYWdlIH0gZnJvbSBcIm5hdGl2ZXNjcmlwdC1zZWN1cmUtc3RvcmFnZVwiO1xuXG5pbXBvcnQgeyBQb3J0Zm9saW9JdGVtU2VydmljZSB9IGZyb20gXCIuL3BvcnRmb2xpby1pdGVtLnNlcnZpY2VcIjtcbmltcG9ydCB7IEN1cnJlbmN5UHJpY2VTZXJ2aWNlIH0gZnJvbSBcIi4vY3VycmVuY3ktcHJpY2Uuc2VydmljZVwiO1xuXG5cbkBJbmplY3RhYmxlKClcbmV4cG9ydCBjbGFzcyBDYWxjdWxhdGlvblNlcnZpY2Uge1xuICAgIHByaXZhdGUgY2FsY3VsYXRpb25SZXN1bHRzOiBBcnJheTxDYWxjdWxhdGlvblJlc3VsdD4gPSBbXTtcbiAgICBwcml2YXRlIHNlY3VyZVN0b3JhZ2U6IFNlY3VyZVN0b3JhZ2UgPSBuZXcgU2VjdXJlU3RvcmFnZSgpO1xuICAgIFxuICAgIGNvbnN0cnVjdG9yKHByaXZhdGUgcmVhZG9ubHkgcG9ydGZvbGlvSXRlbVNlcnZpY2U6IFBvcnRmb2xpb0l0ZW1TZXJ2aWNlLFxuICAgICAgICAgICAgICAgIHByaXZhdGUgcmVhZG9ubHkgY3VycmVuY3lQcmljZVNlcnZpY2U6IEN1cnJlbmN5UHJpY2VTZXJ2aWNlKSB7IH1cblxuICAgIGFkZENhbGN1bGF0aW9uUmVzdWx0KGNhbGN1bGF0aW9uUmVzdWx0KSB7XG4gICAgICAgIHRoaXMuY2FsY3VsYXRpb25SZXN1bHRzLnB1c2goY2FsY3VsYXRpb25SZXN1bHQpO1xuICAgIH1cblxuXG4gICAgY3JlYXRlQ2FsY3VsYXRpb25SZXN1bHQoc291cmNlUG9ydGZvbGlvSXRlbU5hbWU6IHN0cmluZywgdGFyZ2V0Q3VycmVuY3lTeW1ib2w6IHN0cmluZywgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IHN0cmluZywgcGxhdGZvcm06IHN0cmluZyk6IENhbGN1bGF0aW9uUmVzdWx0IHtcbiAgICAgICAgbGV0IHBvcnRmb2xpb0l0ZW0gPSB0aGlzLnBvcnRmb2xpb0l0ZW1TZXJ2aWNlLmdldFBvcnRmb2xpb0l0ZW1CeVRlY2huaWNhbE5hbWUoc291cmNlUG9ydGZvbGlvSXRlbU5hbWUsIHBsYXRmb3JtKTtcbiAgICAgICAgbGV0IGN1cnJlbmN5UHJpY2UgPSB0aGlzLmN1cnJlbmN5UHJpY2VTZXJ2aWNlLmdldEN1cnJlbmN5UHJpY2UocG9ydGZvbGlvSXRlbS5nZXRTeW1ib2woKSwgdGFyZ2V0Q3VycmVuY3lTeW1ib2wsIHBsYXRmb3JtKTtcbiAgICAgICAgXG4gICAgICAgIGxldCBuZXdDYWxjdWxhdGlvblJlc3VsdCA9IG5ldyBDYWxjdWxhdGlvblJlc3VsdChkZXNjcmlwdGlvbiwgcG9ydGZvbGlvSXRlbSwgY3VycmVuY3lQcmljZSwgcGxhdGZvcm0pO1xuXG4gICAgICAgIHRoaXMuY2FsY3VsYXRpb25SZXN1bHRzLnB1c2gobmV3Q2FsY3VsYXRpb25SZXN1bHQpO1xuXG4gICAgICAgIHJldHVybiBuZXdDYWxjdWxhdGlvblJlc3VsdDtcbiAgICB9XG5cblxuICAgIGNhbGN1bGF0ZUFsbFJlc3VsdHMoKSB7XG4gICAgICAgIGZvcih2YXIgaT0wOyBpPHRoaXMuY2FsY3VsYXRpb25SZXN1bHRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICB0aGlzLmNhbGN1bGF0ZVJlc3VsdCh0aGlzLmNhbGN1bGF0aW9uUmVzdWx0c1tpXSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBjYWxjdWxhdGVSZXN1bHQoY2FsY3VsYXRpb25SZXN1bHQ6IENhbGN1bGF0aW9uUmVzdWx0KSB7XG4gICAgICAgIGNhbGN1bGF0aW9uUmVzdWx0LmdldFJlc3VsdCgpO1xuICAgIH1cblxuICAgIGdldEFsbENhbGN1bGF0aW9uUmVzdWx0cygpOiBBcnJheTxDYWxjdWxhdGlvblJlc3VsdD4ge1xuICAgICAgICByZXR1cm4gdGhpcy5jYWxjdWxhdGlvblJlc3VsdHM7XG4gICAgfVxuXG4gICAgLy9UT0RPOiBzYXZlIGFuZCBsb2FkIGhhdmUgdG8gYmUgcmVuZXdlZFxuXG4gICAgc2F2ZUNhbGN1bGF0aW9uUmVzdWx0cygpIHtcbiAgICAgICAgdGhpcy5zZWN1cmVTdG9yYWdlLnNldFN5bmMoe1xuICAgICAgICAgICAga2V5OiBcImNyeXB0b0NvaW5DYWxjQ2FsY3VsYXRpb25SZXN1bHREYXRhXCIsXG4gICAgICAgICAgICB2YWx1ZTogSlNPTi5zdHJpbmdpZnkodGhpcy5jYWxjdWxhdGlvblJlc3VsdHMpXG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIGxvYWRDdXJyZW5jeVByaWNlcygpIHtcbiAgICAgICAgbGV0IHN0b3JlZENhbGN1bGF0aW9uUmVzdWx0U3RyaW5nID0gdGhpcy5zZWN1cmVTdG9yYWdlLmdldFN5bmMoe1xuICAgICAgICAgICAga2V5OiBcImNyeXB0b0NvaW5DYWxjQ2FsY3VsYXRpb25SZXN1bHREYXRhXCIsXG4gICAgICAgIH0pO1xuXG4gICAgICAgIGlmIChzdG9yZWRDYWxjdWxhdGlvblJlc3VsdFN0cmluZykge1xuICAgICAgICAgICAgbGV0IHN0b3JlZENhbGN1bGF0aW9uUmVzdWx0cyA9IEpTT04ucGFyc2Uoc3RvcmVkQ2FsY3VsYXRpb25SZXN1bHRTdHJpbmcpO1xuXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHN0b3JlZENhbGN1bGF0aW9uUmVzdWx0cy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIGxldCBzdG9yZWRDYWxjdWxhdGlvblJlc3VsdCA9IHN0b3JlZENhbGN1bGF0aW9uUmVzdWx0c1tpXTtcblxuICAgICAgICAgICAgICAgIHRoaXMuY3JlYXRlQ2FsY3VsYXRpb25SZXN1bHQoc3RvcmVkQ2FsY3VsYXRpb25SZXN1bHQuY3VycmVuY3lDb2RlRnJvbSxcbiAgICAgICAgICAgICAgICAgICAgc3RvcmVkQ2FsY3VsYXRpb25SZXN1bHQuY3VycmVuY3lDb2RlVG8sXG4gICAgICAgICAgICAgICAgICAgIHN0b3JlZENhbGN1bGF0aW9uUmVzdWx0LmRlc2NyaXB0aW9uLFxuICAgICAgICAgICAgICAgICAgICBzdG9yZWRDYWxjdWxhdGlvblJlc3VsdC5wbGF0Zm9ybSk7XG5cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbn0iXX0=