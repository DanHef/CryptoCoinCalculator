"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var core_1 = require("@angular/core");
var CalculationResult_1 = require("../CalculationResult");
var nativescript_secure_storage_1 = require("nativescript-secure-storage");
var portfolio_item_service_1 = require("./portfolio-item.service");
var currency_price_service_1 = require("./currency-price.service");
var CalculationService = (function () {
    function CalculationService(portfolioItemService, currencyPriceService) {
        this.portfolioItemService = portfolioItemService;
        this.currencyPriceService = currencyPriceService;
        this.calculationResults = [];
        this.secureStorage = new nativescript_secure_storage_1.SecureStorage();
    }
    CalculationService.prototype.addCalculationResult = function (calculationResult) {
        this.calculationResults.push(calculationResult);
    };
    CalculationService.prototype.createCalculationResult = function (sourcePortfolioItemName, targetCurrencySymbol, description, platform) {
        var portfolioItem = this.portfolioItemService.getPortfolioItemByTechnicalName(sourcePortfolioItemName, platform);
        var currencyPrice = this.currencyPriceService.getCurrencyPrice(portfolioItem.getSymbol(), targetCurrencySymbol, platform);
        var newCalculationResult = new CalculationResult_1.CalculationResult(description, portfolioItem, currencyPrice, platform, targetCurrencySymbol);
        this.calculationResults.push(newCalculationResult);
        return newCalculationResult;
    };
    CalculationService.prototype.deleteCalculationResult = function (calculationResult) {
        for (var i = 0; i < this.calculationResults.length; i++) {
            var calcResult = this.calculationResults[i];
            if (calcResult.getPlatform() === calculationResult.getPlatform() &&
                calcResult.getDescription() === calculationResult.getDescription() &&
                calcResult.getTargetCurrency() === calculationResult.getTargetCurrency() &&
                calcResult.getSourcePortfolioItem() === calculationResult.getSourcePortfolioItem()) {
                this.calculationResults.splice(i, 1);
            }
        }
    };
    CalculationService.prototype.calculateAllResults = function () {
        for (var i = 0; i < this.calculationResults.length; i++) {
            this.calculateResult(this.calculationResults[i]);
        }
    };
    CalculationService.prototype.calculateResult = function (calculationResult) {
        calculationResult.getResult();
    };
    CalculationService.prototype.getAllCalculationResults = function () {
        return this.calculationResults;
    };
    //TODO: save and load have to be renewed
    CalculationService.prototype.saveCalculationResults = function () {
        this.secureStorage.setSync({
            key: "cryptoCoinCalcCalculationResultData",
            value: JSON.stringify(this.calculationResults)
        });
    };
    CalculationService.prototype.loadCurrencyPrices = function () {
        var storedCalculationResultString = this.secureStorage.getSync({
            key: "cryptoCoinCalcCalculationResultData",
        });
        if (storedCalculationResultString) {
            var storedCalculationResults = JSON.parse(storedCalculationResultString);
            for (var i = 0; i < storedCalculationResults.length; i++) {
                var storedCalculationResult = storedCalculationResults[i];
                this.createCalculationResult(storedCalculationResult.sourcePortfolioItem.portfolioItemName, storedCalculationResult.targetCurrency, storedCalculationResult.description, storedCalculationResult.platform);
            }
        }
    };
    CalculationService = __decorate([
        core_1.Injectable(),
        __metadata("design:paramtypes", [portfolio_item_service_1.PortfolioItemService,
            currency_price_service_1.CurrencyPriceService])
    ], CalculationService);
    return CalculationService;
}());
exports.CalculationService = CalculationService;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2FsY3VsYXRpb24uc2VydmljZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbImNhbGN1bGF0aW9uLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxzQ0FBMkM7QUFFM0MsMERBQXlEO0FBQ3pELDJFQUE0RDtBQUU1RCxtRUFBZ0U7QUFDaEUsbUVBQWdFO0FBSWhFO0lBSUksNEJBQTZCLG9CQUEwQyxFQUMxQyxvQkFBMEM7UUFEMUMseUJBQW9CLEdBQXBCLG9CQUFvQixDQUFzQjtRQUMxQyx5QkFBb0IsR0FBcEIsb0JBQW9CLENBQXNCO1FBSi9ELHVCQUFrQixHQUE2QixFQUFFLENBQUM7UUFDbEQsa0JBQWEsR0FBa0IsSUFBSSwyQ0FBYSxFQUFFLENBQUM7SUFHZ0IsQ0FBQztJQUU1RSxpREFBb0IsR0FBcEIsVUFBcUIsaUJBQWlCO1FBQ2xDLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxJQUFJLENBQUMsaUJBQWlCLENBQUMsQ0FBQztJQUNwRCxDQUFDO0lBR0Qsb0RBQXVCLEdBQXZCLFVBQXdCLHVCQUErQixFQUFFLG9CQUE0QixFQUM3RCxXQUFtQixFQUFFLFFBQWdCO1FBQ3pELElBQUksYUFBYSxHQUFHLElBQUksQ0FBQyxvQkFBb0IsQ0FBQywrQkFBK0IsQ0FBQyx1QkFBdUIsRUFBRSxRQUFRLENBQUMsQ0FBQztRQUNqSCxJQUFJLGFBQWEsR0FBRyxJQUFJLENBQUMsb0JBQW9CLENBQUMsZ0JBQWdCLENBQUMsYUFBYSxDQUFDLFNBQVMsRUFBRSxFQUFFLG9CQUFvQixFQUFFLFFBQVEsQ0FBQyxDQUFDO1FBRTFILElBQUksb0JBQW9CLEdBQUcsSUFBSSxxQ0FBaUIsQ0FBQyxXQUFXLEVBQUUsYUFBYSxFQUFFLGFBQWEsRUFBRSxRQUFRLEVBQUUsb0JBQW9CLENBQUMsQ0FBQztRQUU1SCxJQUFJLENBQUMsa0JBQWtCLENBQUMsSUFBSSxDQUFDLG9CQUFvQixDQUFDLENBQUM7UUFFbkQsTUFBTSxDQUFDLG9CQUFvQixDQUFDO0lBQ2hDLENBQUM7SUFHRCxvREFBdUIsR0FBdkIsVUFBd0IsaUJBQW9DO1FBQ3hELEdBQUcsQ0FBQSxDQUFDLElBQUksQ0FBQyxHQUFDLENBQUMsRUFBRSxDQUFDLEdBQUMsSUFBSSxDQUFDLGtCQUFrQixDQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDO1lBQ2pELElBQUksVUFBVSxHQUFHLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUM1QyxFQUFFLENBQUEsQ0FBQyxVQUFVLENBQUMsV0FBVyxFQUFFLEtBQUssaUJBQWlCLENBQUMsV0FBVyxFQUFFO2dCQUMzRCxVQUFVLENBQUMsY0FBYyxFQUFFLEtBQUssaUJBQWlCLENBQUMsY0FBYyxFQUFFO2dCQUNsRSxVQUFVLENBQUMsaUJBQWlCLEVBQUUsS0FBSyxpQkFBaUIsQ0FBQyxpQkFBaUIsRUFBRTtnQkFDeEUsVUFBVSxDQUFDLHNCQUFzQixFQUFFLEtBQUssaUJBQWlCLENBQUMsc0JBQXNCLEVBQUUsQ0FBQyxDQUFDLENBQUM7Z0JBQ2pGLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxNQUFNLENBQUMsQ0FBQyxFQUFDLENBQUMsQ0FBQyxDQUFDO1lBQzVDLENBQUM7UUFDTCxDQUFDO0lBQ0wsQ0FBQztJQUdELGdEQUFtQixHQUFuQjtRQUNJLEdBQUcsQ0FBQSxDQUFDLElBQUksQ0FBQyxHQUFDLENBQUMsRUFBRSxDQUFDLEdBQUMsSUFBSSxDQUFDLGtCQUFrQixDQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDO1lBQ2pELElBQUksQ0FBQyxlQUFlLENBQUMsSUFBSSxDQUFDLGtCQUFrQixDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDckQsQ0FBQztJQUNMLENBQUM7SUFFRCw0Q0FBZSxHQUFmLFVBQWdCLGlCQUFvQztRQUNoRCxpQkFBaUIsQ0FBQyxTQUFTLEVBQUUsQ0FBQztJQUNsQyxDQUFDO0lBRUQscURBQXdCLEdBQXhCO1FBQ0ksTUFBTSxDQUFDLElBQUksQ0FBQyxrQkFBa0IsQ0FBQztJQUNuQyxDQUFDO0lBRUQsd0NBQXdDO0lBRXhDLG1EQUFzQixHQUF0QjtRQUNJLElBQUksQ0FBQyxhQUFhLENBQUMsT0FBTyxDQUFDO1lBQ3ZCLEdBQUcsRUFBRSxxQ0FBcUM7WUFDMUMsS0FBSyxFQUFFLElBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDLGtCQUFrQixDQUFDO1NBQ2pELENBQUMsQ0FBQztJQUNQLENBQUM7SUFFRCwrQ0FBa0IsR0FBbEI7UUFDSSxJQUFJLDZCQUE2QixHQUFHLElBQUksQ0FBQyxhQUFhLENBQUMsT0FBTyxDQUFDO1lBQzNELEdBQUcsRUFBRSxxQ0FBcUM7U0FDN0MsQ0FBQyxDQUFDO1FBRUgsRUFBRSxDQUFDLENBQUMsNkJBQTZCLENBQUMsQ0FBQyxDQUFDO1lBQ2hDLElBQUksd0JBQXdCLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyw2QkFBNkIsQ0FBQyxDQUFDO1lBRXpFLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsd0JBQXdCLENBQUMsTUFBTSxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUM7Z0JBQ3ZELElBQUksdUJBQXVCLEdBQUcsd0JBQXdCLENBQUMsQ0FBQyxDQUFDLENBQUM7Z0JBRTFELElBQUksQ0FBQyx1QkFBdUIsQ0FBQyx1QkFBdUIsQ0FBQyxtQkFBbUIsQ0FBQyxpQkFBaUIsRUFDdEYsdUJBQXVCLENBQUMsY0FBYyxFQUN0Qyx1QkFBdUIsQ0FBQyxXQUFXLEVBQ25DLHVCQUF1QixDQUFDLFFBQVEsQ0FBQyxDQUFDO1lBRTFDLENBQUM7UUFDTCxDQUFDO0lBQ0wsQ0FBQztJQS9FUSxrQkFBa0I7UUFEOUIsaUJBQVUsRUFBRTt5Q0FLMEMsNkNBQW9CO1lBQ3BCLDZDQUFvQjtPQUw5RCxrQkFBa0IsQ0FnRjlCO0lBQUQseUJBQUM7Q0FBQSxBQWhGRCxJQWdGQztBQWhGWSxnREFBa0IiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSBcIkBhbmd1bGFyL2NvcmVcIjtcblxuaW1wb3J0IHsgQ2FsY3VsYXRpb25SZXN1bHQgfSBmcm9tIFwiLi4vQ2FsY3VsYXRpb25SZXN1bHRcIjtcbmltcG9ydCB7IFNlY3VyZVN0b3JhZ2UgfSBmcm9tIFwibmF0aXZlc2NyaXB0LXNlY3VyZS1zdG9yYWdlXCI7XG5cbmltcG9ydCB7IFBvcnRmb2xpb0l0ZW1TZXJ2aWNlIH0gZnJvbSBcIi4vcG9ydGZvbGlvLWl0ZW0uc2VydmljZVwiO1xuaW1wb3J0IHsgQ3VycmVuY3lQcmljZVNlcnZpY2UgfSBmcm9tIFwiLi9jdXJyZW5jeS1wcmljZS5zZXJ2aWNlXCI7XG5cblxuQEluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIENhbGN1bGF0aW9uU2VydmljZSB7XG4gICAgcHJpdmF0ZSBjYWxjdWxhdGlvblJlc3VsdHM6IEFycmF5PENhbGN1bGF0aW9uUmVzdWx0PiA9IFtdO1xuICAgIHByaXZhdGUgc2VjdXJlU3RvcmFnZTogU2VjdXJlU3RvcmFnZSA9IG5ldyBTZWN1cmVTdG9yYWdlKCk7XG4gICAgXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSByZWFkb25seSBwb3J0Zm9saW9JdGVtU2VydmljZTogUG9ydGZvbGlvSXRlbVNlcnZpY2UsXG4gICAgICAgICAgICAgICAgcHJpdmF0ZSByZWFkb25seSBjdXJyZW5jeVByaWNlU2VydmljZTogQ3VycmVuY3lQcmljZVNlcnZpY2UpIHsgfVxuXG4gICAgYWRkQ2FsY3VsYXRpb25SZXN1bHQoY2FsY3VsYXRpb25SZXN1bHQpIHtcbiAgICAgICAgdGhpcy5jYWxjdWxhdGlvblJlc3VsdHMucHVzaChjYWxjdWxhdGlvblJlc3VsdCk7XG4gICAgfVxuXG5cbiAgICBjcmVhdGVDYWxjdWxhdGlvblJlc3VsdChzb3VyY2VQb3J0Zm9saW9JdGVtTmFtZTogc3RyaW5nLCB0YXJnZXRDdXJyZW5jeVN5bWJvbDogc3RyaW5nLCBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogc3RyaW5nLCBwbGF0Zm9ybTogc3RyaW5nKTogQ2FsY3VsYXRpb25SZXN1bHQge1xuICAgICAgICBsZXQgcG9ydGZvbGlvSXRlbSA9IHRoaXMucG9ydGZvbGlvSXRlbVNlcnZpY2UuZ2V0UG9ydGZvbGlvSXRlbUJ5VGVjaG5pY2FsTmFtZShzb3VyY2VQb3J0Zm9saW9JdGVtTmFtZSwgcGxhdGZvcm0pO1xuICAgICAgICBsZXQgY3VycmVuY3lQcmljZSA9IHRoaXMuY3VycmVuY3lQcmljZVNlcnZpY2UuZ2V0Q3VycmVuY3lQcmljZShwb3J0Zm9saW9JdGVtLmdldFN5bWJvbCgpLCB0YXJnZXRDdXJyZW5jeVN5bWJvbCwgcGxhdGZvcm0pO1xuICAgICAgICBcbiAgICAgICAgbGV0IG5ld0NhbGN1bGF0aW9uUmVzdWx0ID0gbmV3IENhbGN1bGF0aW9uUmVzdWx0KGRlc2NyaXB0aW9uLCBwb3J0Zm9saW9JdGVtLCBjdXJyZW5jeVByaWNlLCBwbGF0Zm9ybSwgdGFyZ2V0Q3VycmVuY3lTeW1ib2wpO1xuXG4gICAgICAgIHRoaXMuY2FsY3VsYXRpb25SZXN1bHRzLnB1c2gobmV3Q2FsY3VsYXRpb25SZXN1bHQpO1xuXG4gICAgICAgIHJldHVybiBuZXdDYWxjdWxhdGlvblJlc3VsdDtcbiAgICB9XG5cblxuICAgIGRlbGV0ZUNhbGN1bGF0aW9uUmVzdWx0KGNhbGN1bGF0aW9uUmVzdWx0OiBDYWxjdWxhdGlvblJlc3VsdCkge1xuICAgICAgICBmb3IodmFyIGk9MDsgaTx0aGlzLmNhbGN1bGF0aW9uUmVzdWx0cy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgbGV0IGNhbGNSZXN1bHQgPSB0aGlzLmNhbGN1bGF0aW9uUmVzdWx0c1tpXTtcbiAgICAgICAgICAgIGlmKGNhbGNSZXN1bHQuZ2V0UGxhdGZvcm0oKSA9PT0gY2FsY3VsYXRpb25SZXN1bHQuZ2V0UGxhdGZvcm0oKSAmJlxuICAgICAgICAgICAgICAgIGNhbGNSZXN1bHQuZ2V0RGVzY3JpcHRpb24oKSA9PT0gY2FsY3VsYXRpb25SZXN1bHQuZ2V0RGVzY3JpcHRpb24oKSAmJlxuICAgICAgICAgICAgICAgIGNhbGNSZXN1bHQuZ2V0VGFyZ2V0Q3VycmVuY3koKSA9PT0gY2FsY3VsYXRpb25SZXN1bHQuZ2V0VGFyZ2V0Q3VycmVuY3koKSAmJlxuICAgICAgICAgICAgICAgIGNhbGNSZXN1bHQuZ2V0U291cmNlUG9ydGZvbGlvSXRlbSgpID09PSBjYWxjdWxhdGlvblJlc3VsdC5nZXRTb3VyY2VQb3J0Zm9saW9JdGVtKCkpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5jYWxjdWxhdGlvblJlc3VsdHMuc3BsaWNlKGksMSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cblxuICAgIGNhbGN1bGF0ZUFsbFJlc3VsdHMoKSB7XG4gICAgICAgIGZvcih2YXIgaT0wOyBpPHRoaXMuY2FsY3VsYXRpb25SZXN1bHRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICB0aGlzLmNhbGN1bGF0ZVJlc3VsdCh0aGlzLmNhbGN1bGF0aW9uUmVzdWx0c1tpXSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBjYWxjdWxhdGVSZXN1bHQoY2FsY3VsYXRpb25SZXN1bHQ6IENhbGN1bGF0aW9uUmVzdWx0KSB7XG4gICAgICAgIGNhbGN1bGF0aW9uUmVzdWx0LmdldFJlc3VsdCgpO1xuICAgIH1cblxuICAgIGdldEFsbENhbGN1bGF0aW9uUmVzdWx0cygpOiBBcnJheTxDYWxjdWxhdGlvblJlc3VsdD4ge1xuICAgICAgICByZXR1cm4gdGhpcy5jYWxjdWxhdGlvblJlc3VsdHM7XG4gICAgfVxuXG4gICAgLy9UT0RPOiBzYXZlIGFuZCBsb2FkIGhhdmUgdG8gYmUgcmVuZXdlZFxuXG4gICAgc2F2ZUNhbGN1bGF0aW9uUmVzdWx0cygpIHtcbiAgICAgICAgdGhpcy5zZWN1cmVTdG9yYWdlLnNldFN5bmMoe1xuICAgICAgICAgICAga2V5OiBcImNyeXB0b0NvaW5DYWxjQ2FsY3VsYXRpb25SZXN1bHREYXRhXCIsXG4gICAgICAgICAgICB2YWx1ZTogSlNPTi5zdHJpbmdpZnkodGhpcy5jYWxjdWxhdGlvblJlc3VsdHMpXG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIGxvYWRDdXJyZW5jeVByaWNlcygpIHtcbiAgICAgICAgbGV0IHN0b3JlZENhbGN1bGF0aW9uUmVzdWx0U3RyaW5nID0gdGhpcy5zZWN1cmVTdG9yYWdlLmdldFN5bmMoe1xuICAgICAgICAgICAga2V5OiBcImNyeXB0b0NvaW5DYWxjQ2FsY3VsYXRpb25SZXN1bHREYXRhXCIsXG4gICAgICAgIH0pO1xuXG4gICAgICAgIGlmIChzdG9yZWRDYWxjdWxhdGlvblJlc3VsdFN0cmluZykge1xuICAgICAgICAgICAgbGV0IHN0b3JlZENhbGN1bGF0aW9uUmVzdWx0cyA9IEpTT04ucGFyc2Uoc3RvcmVkQ2FsY3VsYXRpb25SZXN1bHRTdHJpbmcpO1xuXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHN0b3JlZENhbGN1bGF0aW9uUmVzdWx0cy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIGxldCBzdG9yZWRDYWxjdWxhdGlvblJlc3VsdCA9IHN0b3JlZENhbGN1bGF0aW9uUmVzdWx0c1tpXTtcblxuICAgICAgICAgICAgICAgIHRoaXMuY3JlYXRlQ2FsY3VsYXRpb25SZXN1bHQoc3RvcmVkQ2FsY3VsYXRpb25SZXN1bHQuc291cmNlUG9ydGZvbGlvSXRlbS5wb3J0Zm9saW9JdGVtTmFtZSxcbiAgICAgICAgICAgICAgICAgICAgc3RvcmVkQ2FsY3VsYXRpb25SZXN1bHQudGFyZ2V0Q3VycmVuY3ksXG4gICAgICAgICAgICAgICAgICAgIHN0b3JlZENhbGN1bGF0aW9uUmVzdWx0LmRlc2NyaXB0aW9uLFxuICAgICAgICAgICAgICAgICAgICBzdG9yZWRDYWxjdWxhdGlvblJlc3VsdC5wbGF0Zm9ybSk7XG5cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cbn0iXX0=